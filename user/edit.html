<FORM METHOD="post" ENCTYPE="multipart/form-data" action="edit.php">
<table cellpadding=9 cellspacing=0 >
<?
if (isadmin()) {
    echo "<tr valign=top>";
	echo "<td><P>".get_string("username").":</td>";
	echo "<td><input type=text name=username size=20 value=\"";
    p($user->username);
    echo "\">";
	echo formerr($err["username"]);
	echo "</td>";
    echo "</tr>";

    echo "<tr valign=top>";
	echo "<td><P>".get_string("newpassword").":</td>";
	echo "<td><input type=text name=newpassword size=20 value=\"";
    p($user->newpassword);
    echo "\">";
	if (isset($err["newpassword"])) {
        formerr($err["newpassword"]);
    } else if (empty($user->newpassword)) {
	    echo "(".get_string("leavetokeep").")";
    }
	echo "</td>";
    echo "</tr>";
}
?>
<tr valign=top>
	<td><P><? print_string("firstname") ?>:</td>
	<td><input type="text" name="firstname" size=30 value="<? p($user->firstname) ?>">
	<? formerr($err["firstname"]) ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("lastname") ?>:</td>
	<td><input type="text" name="lastname" size=30 value="<? p($user->lastname) ?>">
	<? formerr($err["lastname"]) ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("email") ?>:</td>
	<td><input type="text" name="email" size=30 value="<? p($user->email) ?>">
	<? formerr($err["email"]) ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("emaildisplay") ?>:</td>
	<td><? 
    $choices["0"] = get_string("emaildisplayno");
    $choices["1"] = get_string("emaildisplayyes");
    $choices["2"] = get_string("emaildisplaycourse");
    choose_from_menu ($choices, "maildisplay", $user->maildisplay, "") ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("emailformat") ?>:</td>
	<td><? 
    unset($choices);
    $choices["0"] = get_string("textformat");
    $choices["1"] = get_string("htmlformat");
    choose_from_menu ($choices, "mailformat", $user->mailformat, "") ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("city") ?>:</td>
	<td><input type="text" name="city" size=25 value="<? p($user->city) ?>">
	<? formerr($err["city"]) ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("country") ?>:</td>
	<td><? choose_from_menu ($COUNTRIES, "country", $user->country, get_string("selectacountry")."...", "", "") ?>
	<? formerr($err["country"]) ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("preferredlanguage") ?>:</td>
	<td><? if ($languages = get_list_of_languages()) {
               if (!$user->lang) {
                   $user->lang = "en";
               }
               choose_from_menu ($languages, "lang", $user->lang, "", "", "");
           }
	       formerr($err["lang"]);
        ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("timezone") ?>:</td>
	<td><?
       if (abs($user->timezone) > 12) {
           $user->timezone = 99;
       }
       $timenow = time();

       for ($tz = -23; $tz <= 24; $tz++) {
           $zone = (float)$tz/2.0;
           $usertime = $timenow + ($tz * 1800);
           if ($tz == 0) {
               $timezones["$zone"] = gmstrftime("%a, %I:%M %p", $usertime)." (GMT)";
           } else if ($tz < 0) {
               $timezones["$zone"] = gmstrftime("%a, %I:%M %p", $usertime)." (GMT$zone)";
           } else {
               $timezones["$zone"] = gmstrftime("%a, %I:%M %p", $usertime)." (GMT+$zone)";
           }
       }

       choose_from_menu ($timezones, "timezone", $user->timezone, get_string("serverlocaltime"), "", "99");

       echo "(".get_string(currentlocaltime).")";
	?>
    </td>
</tr>
<tr valign=top>
	<td><P><? print_string("userdescription") ?>:</td>
	<td><TEXTAREA NAME=description COLS=50 ROWS=10 WRAP=virtual><? p($user->description) ?></TEXTAREA> 
    <? helpbutton("text", get_string("helptext")) ?>
	<? formerr($err["description"]) ?>
	</td>
</tr>
<tr>
    <td colspan=2><BR><B><? print_string("followingoptional") ?>:</B></td>
</tr>
<tr valign=top>
	<td><P><? print_string("newpicture") ?>:</td>
	<td>
    <INPUT type="hidden" name="MAX_FILE_SIZE" value="<? echo get_max_upload_file_size() ?>">
    <input type="file" name="imagefile" size=40>
    <? helpbutton("picture", get_string("helppicture"));
       print_string("maxsize", "", display_size(get_max_upload_file_size())); 
	   formerr($err["imagefile"]);
    ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("webpage") ?>:</td>
	<td><input type="text" name="url" size=50 value="<? p($user->url) ?>">
	<? formerr($err["url"]) ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("icqnumber") ?>:</td>
	<td><input type="text" name="icq" size=25 value="<? p($user->icq) ?>">
	<? formerr($err["icq"]) ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("idnumber") ?>:</td>
	<td><input type="text" name="idnumber" size=25 value="<? p($user->idnumber) ?>"> <? p($teacheronly) ?>
	<? formerr($err["idnumber"]) ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("phone") ?> 1:</td>
	<td><input type="text" name="phone1" size=25 value="<? p($user->phone1) ?>"> <? p($teacheronly) ?>
	<? formerr($err["phone1"]) ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("phone") ?> 2:</td>
	<td><input type="text" name="phone2" size=25 value="<? p($user->phone2) ?>"> <? p($teacheronly) ?>
	<? formerr($err["phone2"]) ?>
	</td>
</tr>
<tr valign=top>
	<td><P><? print_string("address") ?>:</td>
	<td><input type="text" name="address" size=25 value="<? p($user->address) ?>"> <? p($teacheronly) ?>
	<? formerr($err["address"]) ?>
	</td>
</tr>
<tr>
	<td></td>
	<td align=right><input type="submit" value="<? print_string("updatemyprofile") ?>"></td>
</TABLE>
<INPUT type="hidden" name="course" value="<? p($course->id) ?>">
<INPUT type="hidden" name="id" value="<? p($user->id) ?>"> 
</FORM>
