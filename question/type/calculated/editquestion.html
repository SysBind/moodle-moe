<?php
$QTYPES[$question->qtype]->print_question_form_start($question, array(), $course, $usehtmleditor);
?>
<tr valign="top">
<td align="right"><b><?php  print_string("correctanswerformula", "quiz") ?>:</b></td>
    <td align="left">
    <input align="left" type="text" id="formula0" name="answers[]" size="20" value="<?php  p($answers[0]->answer) ?>" alt="<?php  print_string("correctanswerformula", "quiz") ?>" />&nbsp;&nbsp;
    <input type="hidden" name="fraction[]" value="1.0" />
    </td>
</tr>
<tr valign="top">
    <td align="right"><b><?php  print_string("tolerance", "quiz"); ?>:</b></td>
    <td align="left">
    <input align="left" type="text" id="tolerance0" name="tolerance[]" size="15" value="<?php  p($answers[0]->tolerance) ?>" alt="<?php  print_string("tolerance", "quiz"); ?>" />&plusmn;
    </td>
</tr>
<tr valign="top">
<td align="right"><b><?php  print_string("tolerancetype", "quiz"); ?>:</b></td>
    <td align="left">
    <?php choose_from_menu($qtypeobj->tolerance_types(),
            'tolerancetype[]', $answers[0]->tolerancetype, false); ?>
    </td>
</tr>
<tr valign="top">
<td align="right"><b><?php  print_string("correctanswershows", "quiz"); ?>:</b></td>
    <td align="left">
    <?php choose_from_menu(array('0' => ' 0 ',
                                 '1' => ' 1 ', '2' => ' 2 ', '3' => ' 3 ',
                                 '4' => ' 4 ', '5' => ' 5 ', '6' => ' 6 ',
                                 '7' => ' 7 ', '8' => ' 8 ', '9' => ' 9 '),
                           'correctanswerlength[]',
                           $answers[0]->correctanswerlength, false); ?>
    <?php choose_from_menu(array('1' => get_string('decimalformat', 'quiz'),
                                 '2' => get_string('significantfiguresformat', 'quiz')),
                           'correctanswerformat[]',
                           $answers[0]->correctanswerformat, false); ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><b><?php  print_string("feedback", "quiz") ?>:</b></td>
    <td align="left">
        <textarea name="feedback[]" rows="2" cols="50"><?php  p($answers[0]->feedback) ?></textarea>
    </td>
</tr>
<tr valign="top">
<td align="right"><b><?php  print_string("unit", "quiz") ?>:</b></td>
    <td align="left">
        <input type="hidden" name="multiplier[]" value="1.0" />
        <input align="left" type="text" id="defaultunit" name="unit[]"
                size="5" value="<?php  p($units[0]->unit) ?>"
                alt="<?php  print_string("unit", "quiz") ?>" />
        <b>(<?php  print_string("optional", "quiz") ?>)</b>
    </td>
</tr>
<tr valign="top">
<td align="left"></td>
<td align="left"><b><?php  print_string("alternativeunits", "quiz") ?>:</b></td>
<td align="left"></td>
</tr>
<?php
for ($i=1; $i<count($units); $i++) {
    $unit=$units[$i];
?>
<tr valign="top">
<td></td>
    <td align="left">
        <b><?php  print_string("multiplier", "quiz") ?>:</b>
        <input type="text" id="<?php  p("multiplier$i") ?>" size="10"
                align="right" name="multiplier[]"
                value="<?php  p($unit->multiplier) ?>"
                alt="<?php  print_string("multiplier", "quiz") ?>" />
        <b>&nbsp;&nbsp;&nbsp;<?php  print_string("unit", "quiz") ?>:</b>
        <input align="left" type="text" id="<?php  p("unit$i") ?>"
                name="unit[]"
                size="5" value="<?php  p($unit->unit) ?>"
                alt="<?php  print_string("unit", "quiz") ?>" />
    </td>
</tr>
<?php
} /// END for

$QTYPES[$question->qtype]->print_replacement_options($question, $course, $contextquiz);
$QTYPES[$question->qtype]->print_question_form_end($question,
        'onclick="return determineMinAndMax();"',
        '<input type="hidden" name="wizardpage" value="question" />');
?>
<script type="text/javascript">
//<![CDATA[
function determineMinAndMax() {
    // This client-side script will determine the values for min and max
    // based on the input for answer and acceptederror.
    with(document.theform) {
        if (formula0.value=='') {
            alert('<?php  print_string("missingformula","quiz") ?>');
            return false;
            /* It could perhaps be an idea to parse the formula here
             * but as it is necessary at the server anyway, we can
             * it leave like this for the moment. */

        } else if (''!=defaultunit.value && !isNaN(defaultunit.value)) {
            alert('<?php  print_string("unitmustnotbenumeric","quiz") ?>');
            return false;
        } else if (isNaN(tolerance0.value)) {
            alert('<?php  print_string("tolerancemustbenumeric","quiz") ?>');
            return false;
        } else if ('2' == document.theform['correctanswerformat[]'].value
                && '0' == document.theform['correctanswerlength[]'].value) {
            alert('<?php  print_string("zerosignificantfiguresnotallowed","quiz") ?>');
            return false;
        } else {
            return true;
        }
    }
}
//]]>
</script>
