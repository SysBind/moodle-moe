<table cellpadding="20" align="center">

  <tr valign="top">
    <td>
      <p align="center">
      <?php
          if ($teacher) {
              $site = get_site();
              $teachername = "<a href=\"../user/view.php?id=$teacher->id&course=$site->id\">".fullname($teacher)."</a>.";
          } else {
              $teachername = get_string("yourteacher", "", strtolower($course->teacher));
          }
          print_string("enrolmentkeyfrom", "", $teachername);
       ?>
       </p>
    </td>
  </tr>

  <tr valign="top">
    <td class=<?php echo ($course->guest==1 ?'"noticebox"':'"generalbox"'); ?> bgcolor="<?php p($THEME->cellcontent) ?>">
      <center><?php if (! empty($this->errormsg)) {formerr($this->errormsg);} ?></center>
      <form name="form" method="post" action="enrol.php">
        <table>
          <tr>
            <td width="50%" align="right"><p><?php print_string("enrolmentkey") ?>:</p></td>
            <td width="50%">
              <input type="password" name="password" size="20" value="<?php p($password) ?>" >
              <input type="hidden" name="id" value="<?php p($course->id) ?>" >
            </td>
          <tr>
            <td width="50%">&nbsp;</td>
            <td width="50%">
              <table cellpadding="1" cellspacing="0" align="center">
                <tr>
                    <td><input type="submit" value="<?php print_string("login") ?>">&nbsp;&nbsp;</form></td>
                    <td><form action="<?php p($CFG->wwwroot)?>/index.php" method="post">
                        <input type="submit" value="<?php print_string("cancel") ?>"></form></td>
                </tr>
              </table>
            </td>
        </table>
    </td>
  </tr>
<?php if ($course->guest==1) {
$strallowguests = get_string("allowguests");
$strloginguest = get_string("loginguest");
$bgcolor = $THEME->cellcontent;
$viewasguest = <<<view_as_guest
  <tr>
    <td class="generalbox" bgcolor="$bgcolor">
      <form name="form" method="post" action="enrol.php">
        <table align="center" cellpadding="20">
          <tbody>
            <tr>
              <td>$strallowguests:&nbsp; </td>
              <td>
                <input name="id" value="$course->id" type="hidden">
                <input name="loginasguest" value="yes" type="hidden">
                <input value="$strloginguest" type="submit">&nbsp;&nbsp;
              </td>
            </tr>
          </tbody>
        </table>
      </form>
    </td>
  </tr>
view_as_guest;
echo $viewasguest;} ?>
</table> 
