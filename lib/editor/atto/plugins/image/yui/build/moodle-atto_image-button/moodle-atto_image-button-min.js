YUI.add("moodle-atto_image-button",function(e,t){var n={TAGS:"img"},r={INPUTALIGNMENT:"atto_image_alignment",INPUTALT:"atto_image_altentry",INPUTHEIGHT:"atto_image_heightentry",INPUTSUMBIT:"atto_image_urlentrysubmit",INPUTURL:"atto_image_urlentry",INPUTWIDTH:"atto_image_widthentry",IMAGEALTWARNING:"atto_image_altwarning",IMAGEBROWSER:"openimagebrowser",IMAGEPRESENTATION:"atto_image_presentation",IMAGEPREVIEW:"atto_image_preview"},i,s;s=function(e,t){this.value=e,this.style=t,this.regex=new RegExp(this._regex_escape(t)+" *: *"+this._regex_escape(e))},s.prototype={value:null,style:null,regex:null,test:function(e){return this.regex.test(e)},_regex_escape:function(e){return e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")},apply:function(e){var t=e.getAttribute("style");t!==""&&t.substr(t.length-1,1)!==";"&&(t+=";"),t+=this.style+": "+this.value+";"},to_select_option:function(){var e=M.util.get_string("alignment_"+this.value.replace("-",""),"atto_image");return value=this.style+": "+this.value,'<option value="'+value+'">'+e+"</option>"}},i=[new s("baseline","vertical-align"),new s("sub","vertical-align"),new s("super","vertical-align"),new s("top","vertical-align"),new s("text-top","vertical-align"),new s("middle","vertical-align"),new s("bottom","vertical-align"),new s("text-bottom","vertical-align"),new s("left","float"),new s("right","float")],M.atto_image=M.atto_image||{dialogue:null,selection:null,init:function(e){var t=function(e,t){e.preventDefault(),M.editor_atto.is_active(t)||M.editor_atto.focus(t),M.atto_image.selection=M.editor_atto.get_selection();if(M.atto_image.selection!==!1){var n;M.atto_image.dialogue?n=M.atto_image.dialogue:n=new M.core.dialogue({visible:!1,modal:!0,close:!0,draggable:!0}),n.set("bodyContent",M.atto_image.get_form_content(t)),n.set("headerContent",M.util.get_string("createimage","atto_image")),n.render(),n.centerDialogue(),M.atto_image.dialogue=n,n.show()}},r=M.util.image_url("e/insert_edit_image","core");M.editor_atto.add_toolbar_button(e.elementid,"image",r,e.group,t);var i=M.editor_atto.get_editable_node(e.elementid);i.on("atto:selectionchanged",function(e){e.selectedNodes.filter(n.TAGS).size()>0?M.editor_atto.add_widget_highlight(e.elementid,"image"):M.editor_atto.remove_widget_highlight(e.elementid,"image")})},open_filepicker:function(e){var t=this.getAttribute("data-editor");e.preventDefault(),M.editor_atto.show_filepicker(t,"image",M.atto_image.filepicker_callback)},filepicker_callback:function(t){if(t.url!==""){var n=e.one("#"+r.INPUTURL);n.set("value",t.url);var i=new Image;i.onload=function(){e.one("#"+r.INPUTWIDTH).set("value",this.width),e.one("#"+r.INPUTHEIGHT).set("value",this.height),e.one("#"+r.IMAGEPREVIEW).set("src",this.src),e.one("#"+r.IMAGEPREVIEW).setStyle("display","inline")},i.src=t.url}},url_changed:function(){var t=e.one("#"+r.INPUTURL);if(t.get("value")!==""){var n=new Image;n.onload=function(){var t;t=e.one("#"+r.INPUTWIDTH),t.get("value")===""&&t.set("value",this.width),t=e.one("#"+r.INPUTHEIGHT),t.get("value")===""&&t.set("value",this.height),t=e.one("#"+r.IMAGEPREVIEW),t.set("src",this.src),t.setStyle("display","inline")},n.src=t.get("value")}},set_image:function(t,n){var i=t.currentTarget.ancestor(".atto_form"),s=i.one("#"+r.INPUTURL).get("value"),o=i.one("#"+r.INPUTALT).get("value"),u=i.one("#"+r.INPUTWIDTH).get("value"),a=i.one("#"+r.INPUTHEIGHT).get("value"),f=i.one("#"+r.INPUTALIGNMENT).get("value"),l=i.one("#"+r.IMAGEPRESENTATION).get("checked"),c;t.preventDefault();if(o===""&&!l){i.one("#"+r.IMAGEALTWARNING).setStyle("display","block"),i.one("#"+r.INPUTALT).setAttribute("aria-invalid",!0),i.one("#"+r.IMAGEPRESENTATION).setAttribute("aria-invalid",!0);return}i.one("#"+r.IMAGEALTWARNING).setStyle("display","none"),i.one("#"+r.INPUTALT).setAttribute("aria-invalid",!1),i.one("#"+r.IMAGEPRESENTATION).setAttribute("aria-invalid",!1),M.atto_image.dialogue.hide(),s!==""&&(M.editor_atto.set_selection(M.atto_image.selection),c='<img src="'+e.Escape.html(s)+'" alt="'+e.Escape.html(o)+'"',u&&(c+=' width="'+e.Escape.html(u)+'"'),a&&(c+=' height="'+e.Escape.html(a)+'"'),l&&(c+=' role="presentation"'),f&&(c+=' style="'+f+'"'),c+="/>",M.editor_atto.insert_html_at_focus_point(c),M.editor_atto.text_updated(n))},_get_selected_image_properties:function(e){var t={src:null,alt:null,width:null,height:null,align:null,display:"inline",presentation:!1},r=M.editor_atto.get_selected_nodes(e).filter(n.TAGS),s,o,u,a,f;if(r.size()>0){o=r.item(0),f=o.getAttribute("style"),u=parseInt(o.getAttribute("width"),10),a=parseInt(o.getAttribute("height"),10),u>0&&(t.width=u),a>0&&(t.height=a);for(s in i)if(i[s].test(f)){t.align=i[s];break}return t.src=o.getAttribute("src"),t.alt=o.getAttribute("alt")||"",t.presentation=o.get("role")==="presentation",t}return!1},get_form_content:function(t){var n={alignment:M.util.get_string("alignment","atto_image"),alt:M.util.get_string("enteralt","atto_image"),browse:M.util.get_string("browserepositories","atto_image"),create:M.util.get_string("createimage","atto_image"),height:M.util.get_string("height","atto_image"),presentation:M.util.get_string("presentation","atto_image"),presentationrequired:M.util.get_string("presentationoraltrequired","atto_image"),preview:M.util.get_string("preview","atto_image"),width:M.util.get_string("width","atto_image"),url:M.util.get_string("enterurl","atto_image")},s,o;s='<form class="atto_form"><label for="'+r.INPUTURL+'">'+n.url+"</label>"+'<input class="fullwidth" type="url" value="" id="'+r.INPUTURL+'" size="32"/>'+"<br/>",M.editor_atto.can_show_filepicker(t,"image")&&(s+='<button id="'+r.IMAGEBROWSER+'" data-editor="'+e.Escape.html(t)+'" type="button">'+n.browse+"</button>"+"<br/>"),s+='<div style="display:none" role="alert" id="'+r.IMAGEALTWARNING+'" class="warning">'+n.presentationrequired+"</div>"+'<label for="'+r.INPUTALT+'">'+n.alt+"</label>"+'<input class="fullwidth" type="text" value="" id="'+r.INPUTALT+'" size="32"/>'+"<br/>",s+='<input type="checkbox" id="'+r.IMAGEPRESENTATION+'"/>'+'<label class="sameline" for="'+
r.IMAGEPRESENTATION+'">'+n.presentation+"</label>"+"<br/>",s+='<label class="sameline" for="'+r.INPUTWIDTH+'">'+n.width+"</label>"+'<input type="text" value="" id="'+r.INPUTWIDTH+'" size="10"/>'+"<br/>",s+='<label class="sameline" for="'+r.INPUTHEIGHT+'">'+n.height+"</label>"+'<input type="text" value="" id="'+r.INPUTHEIGHT+'" size="10"/>'+"<br/>",s+='<label class="sameline" for="'+r.INPUTALIGNMENT+'">'+n.alignment+"</label>"+'<select id="'+r.INPUTALIGNMENT+'">';for(o in i)s+=i[o].to_select_option();s+="</select><br/>",s+='<label for="'+r.IMAGEPREVIEW+'">'+n.preview+"</label>"+'<img src="#" width="200" id="'+r.IMAGEPREVIEW+'" alt="" style="display: none;"/>'+'<div class="mdl-align">'+"<br/>",s+='<button id="'+r.INPUTSUMBIT+'" type="submit">'+n.create+"</button>"+"</div>"+"</form>";var u=e.Node.create(s);return this._apply_image_properties(u,t),u.one("#"+r.INPUTURL).on("blur",M.atto_image.url_changed,this),u.one("#"+r.INPUTSUMBIT).on("click",M.atto_image.set_image,this,t),M.editor_atto.can_show_filepicker(t,"image")&&u.one("#"+r.IMAGEBROWSER).on("click",M.atto_image.open_filepicker),u},_apply_image_properties:function(e,t){var n=this._get_selected_image_properties(t),i=e.one("#"+r.IMAGEPREVIEW);if(n===!1){i.setStyle("display","none");return}n.align&&n.align.apply(i),n.display&&i.setStyle("display",n.display),n.width&&e.one("#"+r.INPUTWIDTH).set("value",n.width),n.height&&e.one("#"+r.INPUTHEIGHT).set("value",n.height),n.alt&&e.one("#"+r.INPUTALT).set("value",n.alt),n.src&&(e.one("#"+r.INPUTURL).set("value",n.src),i.setAttribute("src",n.src)),n.presentation&&e.one("#"+r.IMAGEPRESENTATION).set("checked","checked")}}},"@VERSION@",{requires:["node","escape"]});
