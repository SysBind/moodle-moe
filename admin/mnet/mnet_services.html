<?php
admin_externalpage_print_header($adminroot);

$logurl = $CFG->wwwroot.
          '/course/report/log/index.php?chooselog=1&showusers=1&showcourses=1&host_course='.$mnet_peer->id.
          '%2F1&user='.'0'.
          '&date=0'.
          '&modid=&modaction=0&logformat=showashtml';

$tabs[] = new tabobject('mnetdetails', 'peers.php?step=update&hostid='.$mnet_peer->id, $strmnetedithost, $strmnetedithost, false);
$tabs[] = new tabobject('mnetservices', 'mnet_services.php?step=list&hostid='.$mnet_peer->id, $strmnetservices, $strmnetservices, false);
if ($mnet_peer->id != $CFG->mnet_all_hosts_id) $tabs[] = new tabobject('mnetlog', $logurl, $strmnetlog, $strmnetlog, false);
print_tabs(array($tabs), 'mnetservices');
print_simple_box_start("center", "");

?>

<form method="post" action="mnet_services.php">
<input type="hidden" name="sesskey" value="<?php echo $USER->sesskey ?>" />
<input type="hidden" name="step" value="<?php echo $mnet_peer->nextstep; ?>" />
<input type="hidden" name="hostid" value="<?php echo ($mnet_peer->id)?  $mnet_peer->id : '0' ; ?>" />
<table cellpadding="9" cellspacing="0" >
<?php 
    foreach($myservices as $name => $versions):
    $version = current($versions);
?>
<tr>
    <td align="left" valign="top" colspan="2">
    <h3><?php echo get_string($name.'_name', $version['parent_type'].'_'.$version['parent'] , $mnet_peer->name); ?></h3>
    <p><?php echo get_string($name.'_description', $version['parent_type'].'_'.$version['parent'], $mnet_peer->name); ?></p>
<?php
        $breakstring = '';
        foreach($versions as $version):
            if (count($versions) > 1) {
                $versionstring = '('.get_string('version','mnet') .' '.$version['apiversion'].')';
            } else {
                $versionstring = '';
            }
    
            echo $breakstring;
?>
    <input type="hidden" name="exists[<?php echo  $version['serviceid']; ?>]" value="1" />
    <input type="checkbox" name="publish[<?php echo $version['serviceid']; ?>]" <?php echo (!empty($version['I_publish']))? 'checked ': '' ; ?>/> Publish <?php echo $versionstring; if (!empty($version['hostsubscribes'])) echo '<a href="#" title="'.get_string('issubscribed','mnet', $mnet_peer->name).'">&radic;</a> '; if (!empty($version['allhosts_publish'])) print_string("enabled_for_all",'mnet',!empty($version['I_publish']));  ?><br />
    <input type="checkbox" name="subscribe[<?php echo $version['serviceid']; ?>]" <?php echo (!empty($version['I_subscribe']))? 'checked ': '' ; ?>/> Subscribe <?php echo $versionstring; if (!empty($version['hostpublishes'])) echo '<a href="#" title="'.get_string('ispublished','mnet', $mnet_peer->name).'">&radic;</a> '; if (!empty($version['allhosts_subscribe'])) print_string("enabled_for_all",'mnet',!empty($version['I_subscribe'])); ?><br />
<?php
            $breakstring = '. . . . . . . . . . . . . . . . . . . . . . . . <br>';
        endforeach;
?>
    </td>
</tr>
<?php
    endforeach;
?>
<tr>
    <td align="left" valign="top" colspan="2">
    <div id="pubTreeLoc"></div>
    </td>
</tr>
<tr>
    <td align="left" valign="top" colspan="2">
    <div id="subTreeLoc"></div>
    </td>
</tr>
<tr>
    <td colspan="2"><input type="submit" value="<?php print_string("savechanges") ?>" /></td>
</tr>
<tr>
    <td align="left" valign="top" colspan="2">
    <div id="formElements"><input type="hidden" name="outer" value="4" /></div>
    </td>
</tr>
<?php

echo '
    </table>
';
print_simple_box_end();
print_simple_box_end();

echo '
</form>
';
admin_externalpage_print_footer($adminroot);
?>
