            <form action="override.php" method="post">     
            <input type="hidden" name="contextid" value="<?php echo $contextid; ?>">
            <input type="hidden" name="roleid" value="<?php echo $roleid; ?>">
<?php
if ($userid) {
    print ('<input type="hidden" name="userid" value="'.$userid.'"/>');
}
if ($courseid) {
    print ('<input type="hidden" name="courseid" value="'.$courseid.'" />');
}?>
            <table class="override">
            <tr>
                <td><?php print_string('capability','role') ?></td>
                <td><?php print_string('inherit','role') ?></td>
                <td><?php print_string('allow','role') ?></td>
                <td><?php print_string('prevent','role') ?></td>
                <td><?php print_string('prohibit','role') ?></td>
            </tr>
            <?php 
            
            // init these 2
            $contextlevel = 0;
            $component = '';

            foreach ($capabilities as $capability) {
            // prints a breaker if component or name or context level  
                if ($capability->component != $component or $capability->contextlevel != $contextlevel) {
                    echo ('<tr><td colspan="5"><b>'.get_component_string($capability->component, $capability->contextlevel).'</b></td></tr>');  
                }
                
                // these 2 are used to see to group same mod/core capabilities together
                $contextlevel = $capability->contextlevel;
                $component = $capability->component;
                
                // check the capability override for this cap, this role in this context
                if (isset($localoverrides[$capability->name])) {
                    $localpermission = $localoverrides[$capability->name]->permission;
                } else {
                    $localpermission = 0;  // Just inherit
                }

                if (isset($r_caps[$capability->name])) {
                    $isallow = $r_caps[$capability->name] > 0;
                    $isprevent = $r_caps[$capability->name] < 0 && $r_caps[$capability->name] > -500;
                    $isprohibit = $r_caps[$capability->name] <= -500;
                } else {
                    $isallow = 0;
                    $isprevent = 0;
                    $isprohibit = 0;  
                }

                $isdisabled = $isprohibit || islegacy($capability->name);
                
            ?>
                
            <tr>
              <td><?php echo get_capability_string($capability->name); ?></td>

                 <td align="center">
                 <input type="radio" name="<?php echo $capability->name; ?>" value="0" 
                    <?php 
                        if ($localpermission == 0) {echo 'checked="checked"';} 
                        if ($isdisabled)           {echo 'disabled="disabled"';}?>>
                 </td>

                 <td align="center" <?php if ($isallow) {echo 'class="capcurrent"';} ?>>
                 <input type="radio" name="<?php echo $capability->name; ?>"
                    <?php echo ' value="'.CAP_ALLOW.'"';
                       if ($localpermission == CAP_ALLOW) {echo ' checked="checked"';} 
                       if ($isdisabled)                   {echo ' disabled="disabled"';}?>>
                 </td>

                 <td align="center" <?php if ($isprevent) {echo 'class="capcurrent"';} ?>>
                 <input type="radio" name="<?php echo $capability->name; ?>" 
                    <?php echo ' value="'.CAP_PREVENT.'"';
                       if ($localpermission == CAP_PREVENT) {echo ' checked="checked"';} 
                       if ($isdisabled)                     {echo ' disabled="disabled"';}?>>
                 </td>

                 <td align="center" <?php if ($isprohibit) {echo 'class="capcurrent"';} ?>>
                 <input type="radio" name="<?php echo $capability->name; ?>"
                    <?php echo ' value="'.CAP_PROHIBIT.'"';
                       if ($localpermission == CAP_PROHIBIT) {echo ' checked="checked"';} 
                       if ($isdisabled)                      {echo ' disabled="disabled"';}?>>
                 </td>
            </tr>
            
            <?php } ?>    
            </table>     
            <br />
            <div align="center"><input type="submit" value="<?php print_string('savechanges') ?>"></div>
            </form>
