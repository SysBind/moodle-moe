<FORM name="theform" method="post" <?=$onsubmit ?> action="question.php">
<CENTER>
<TABLE cellpadding=5>
<TR valign=top>
    <TD align=right><P><B><? print_string("category", "quiz") ?>:</B></P></TD>
    <TD>
    <?  choose_from_menu($categories, "category", "$question->category", ""); ?>
    </TD>
</TR>
<TR valign=top>
    <TD align=right><P><B><? print_string("questionname", "quiz") ?>:</B></P></TD>
    <TD>
        <INPUT type="text" name="name" size=50 value="<? p($question->name) ?>">
        <? if (isset($err["name"])) formerr($err["name"]); ?>
    </TD>
</TR>
<TR valign=top>
    <TD align=right><P><B><? print_string("question", "quiz") ?>:</B></P></TD>
    <TD>
        <? if (isset($err["questiontext"])) {
               formerr($err["questiontext"]); 
               echo "<BR \>";
           }
           print_textarea($usehtmleditor, 15, 60, 630, 300, "questiontext", $question->questiontext);
           if ($usehtmleditor) {
               helpbutton("richtext", get_string("helprichtext"), "moodle");
           } else {
               helpbutton("text", get_string("helptext"), "moodle");
           }
        ?>
    </TD>
</TR>
<TR valign=top>
    <TD align=right><P><B><? print_string("imagedisplay", "quiz") ?>:</B></P></TD>
    <TD>
    <?  if (empty($images)) {
            print_string("noimagesyet");
        } else {
            choose_from_menu($images, "image", "$question->image", get_string("none"),"","");
        }
    ?>
    </TD>
</TR>

<TR valign=top>
    <TD align=right><P><B><? print_string("correctanswer", "quiz") ?>:</B></P></TD>
    <?
        // Even thou the rest of the module can handle up to six numerical answers,
        // this form will limit the number of numerical answers to one only.
        if (is_numeric($answers[0]->min) && is_numeric($answers[0]->answer)) {
            $acceptederror = (float)($answers[0]->answer)
                           - (float)($answers[0]->min);
        } else {
            $acceptederror = "";
        }
    ?>
    <TD>
        <INPUT align="RIGHT" type="text" id="correct0" name="answer[]" size="20" value="<? p($answers[0]->answer) ?>"/>&nbsp;&nbsp;
        <B><? print_string("acceptederror", "quiz"); ?>:</B>&nbsp;
        <INPUT align="LEFT" type="text" id="acceptederror0" name="acceptederror[]" size="15" value="<? p($acceptederror) ?>" />
        <!-- Values max and min will be determined when the form is submitted -->
        <INPUT type="HIDDEN" id="min0" name="min[]" value=""/>
        <INPUT type="HIDDEN" id="max0" name="max[]" value=""/>
        <INPUT type="HIDDEN" name="fraction[]" value="1"/>
        <BR/>
    </TD>
</TR>
<TR valign=top>
    <TD align=right><P><B><? print_string("feedback", "quiz") ?>:</B></P></TD>
    <TD>
        <textarea name="feedback[]" rows=2 cols=50 wrap="virtual"><? p($answers[0]->feedback) ?></textarea>
    </TD>
</TR>
</TABLE>

<INPUT type="hidden" name=id value="<? p($question->id) ?>">
<INPUT type="hidden" name=qtype value="<? p($question->qtype) ?>">
<INPUT type="submit" onClick="return determineMinAndMax();"  value="<? print_string("savechanges") ?>">
</CENTER>
</FORM>
<SCRIPT language="JAVASCRIPT">
function determineMinAndMax() {
    // This client-side script will determine the values for min and max
    // based on the input for answer and acceptederror.
    with(document.theform) {
        if (correct0.value=='') {
            alert('<? print_string("missingcorrectanswer","quiz") ?>');
            return false;
        } else if (acceptederror0.value=='') {
            var correct= parseFloat(correct0.value);
            if (!isNaN(correct)) {
                min0.value= correct;
                max0.value= correct;
            }
            return true;
        } else if (isNaN(acceptederror0.value) || isNaN(correct0.value)) {
            alert('<? print_string("answerswithacceptederrormarginmustbenumeric", "quiz") ?>');
            return false;
        } else {
            var correct= parseFloat(correct0.value);
            var error= Math.abs(acceptederror0.value);
            min0.value= correct-error;
            max0.value= correct+error;
            return true;
        }
    }
}
</SCRIPT>
<? 
   if ($usehtmleditor) { 
       print_richedit_javascript("theform", "questiontext", "no");
   }
?>

