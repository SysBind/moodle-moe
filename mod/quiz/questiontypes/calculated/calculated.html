<form name="theform" method="post" action="question.php">
<center>
<input type="hidden" name="nextwizardpage" value="<?php p($nextwizardpage)?>" />
<?php foreach ($calculatedmessages as $message) {formerr("$message<br/>");} ?>
<table cellpadding="5">
<tr valign="top">
    <td align="right"><p><b><?php  print_string("category", "quiz") ?>:</b></p></td>
    <td>
    <?php   quiz_category_select_menu($course->id, true, true, $question->category); ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><p><b><?php  print_string("questionname", "quiz") ?>:</b></p></td>
    <td>
        <input type="text" name="name" size="50" value="<?php  p($question->name) ?>" />
        <?php  if (isset($err["name"])) formerr($err["name"]); ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><p><b><?php  print_string("question", "quiz") ?>:</b></p>
    <br />
    <br />
    <br />
    <p><font size="1">
    <?php
           if ($usehtmleditor) {
               helpbutton("richtext", get_string("helprichtext"), "moodle", true, true);
           } else {
               helpbutton("text", get_string("helptext"), "moodle", true, true);
           }
    ?>
    </font></p>
    </td>
    <td>
        <?php  if (isset($err["questiontext"])) {
               formerr($err["questiontext"]); 
               echo "<br />";
           }

           print_textarea($usehtmleditor, 20, 60, 630, 300, "questiontext", $question->questiontext);

           if ($usehtmleditor) {   /// Trying this out for a while
               echo '<input type="hidden" name="questiontextformat" value="'.FORMAT_HTML.'" />';
           } else {
               echo "<div align=\"right\">";
               print_string("formattexttype");
               echo ":&nbsp;";
               if (!isset($question->questiontextformat)) {
                   $question->questiontextformat = FORMAT_MOODLE;
               }
               choose_from_menu(format_text_menu(), "questiontextformat", $question->questiontextformat, "");
               helpbutton("textformat", get_string("helpformatting"));
               echo "</div>";
           }
        ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><p><b><?php  print_string("imagedisplay", "quiz") ?>:</b></p></td>
    <td>
    <?php   if (empty($images)) {
            print_string("noimagesyet");
        } else {
            choose_from_menu($images, "image", "$question->image", get_string("none"),"","");
        }
    ?>
    </td>
</tr>

<tr valign="top">
<td align="right"><p><b><?php  print_string("correctanswerformula", "quiz") ?>:</b></p></td>
    <td>
    <input align="LEFT" type="text" id="formula0" name="answer[]" size="20" value="<?php  p($answers[0]->answer) ?>" />&nbsp;&nbsp;
    <input type="hidden" name="fraction[]" value="1.0" />
    </td>
</tr>
<tr valign="top">
    <td align="right"><p><b><?php  print_string("tolerance", "quiz"); ?>:</b></p></td>
    <td>
    <input align="LEFT" type="text" id="tolerance0" name="tolerance[]" size="15" value="<?php  p($answers[0]->tolerance) ?>" />&plusmn;
    </td>
</tr>
<tr valign="top">
<td align="right"><p><b><?php  print_string("tolerancetype", "quiz"); ?>:</b></p></td>
    <td>
    <?php choose_from_menu($qtypeobj->tolerance_types(),
            'tolerancetype[]', $answers[0]->tolerancetype, false); ?>
    </td>
</tr>
<tr valign="top">
<td align="right"><p><b><?php  print_string("correctanswerlength", "quiz"); ?>:</b></p></td>
    <td>
    <?php choose_from_menu(array('1' => '1', '2' => '2', '3' => '3',
                                 '4' => '4', '5' => '5', '6' => '6',
                                 '7' => '7', '8' => '8', '9' => '9',
                                 '10' => '10'),
                           'correctanswerlength[]',
                           $answers[0]->correctanswerlength, false); ?>
    </td>
</tr>
<tr valign="top">
    <td align="right"><p><b><?php  print_string("feedback", "quiz") ?>:</b></p></td>
    <td>
        <textarea name="feedback[]" rows="2" cols="50" wrap="virtual"><?php  p($answers[0]->feedback) ?></textarea>
    </td>
</tr>
<tr valign="top">
<td align="right"><p><b><?php  print_string("unit", "quiz") ?>:</b></p></td>
    <td>
        <p><input type="HIDDEN" name="multiplier[]" value="1.0" />
        <input align="LEFT" type="text" id="defaultunit" name="unit[]"
                size="5" value="<?php  p($units[0]->unit) ?>" />
        <b>(<?php  print_string("optional", "quiz") ?>)</b></p>
    </td>
</tr>
<tr valign="top">
<td></td>
<td align="left"><p><b><?php  print_string("alternativeunits", "quiz") ?>:</b></p></td>
<td></td>
</tr>
<?php
for ($i=1; $i<count($units); $i++) {
    $unit=$units[$i];
?>
<tr valign="top">
<td></td>
    <td align="left">
        <p><b><?php  print_string("multiplier", "quiz") ?>:</b>
        <input type="text" id="<?php  p("multiplier$i") ?>" size="10"
                align="RIGHT" name="multiplier[]"
                value="<?php  p($unit->multiplier) ?>" />
        <b>&nbsp;&nbsp;&nbsp;<?php  print_string("unit", "quiz") ?>:</b>
        <input align="LEFT" type="text" id="<?php  p("unit$i") ?>"
                name="unit[]"
                size="5" value="<?php  p($unit->unit) ?>" /></p>
    </td>
</tr>
<?php
} /// END for
?>
</table>

<input type="hidden" name="id" value="<?php  p($question->id) ?>" />
<input type="hidden" name="qtype" value="<?php  p($question->qtype) ?>" />
<input type="submit" onClick="return determineMinAndMax();"  value="<?php  print_string("savechanges") ?>" />
</center>
</form>
<script language="javascript">
function determineMinAndMax() {
    // This client-side script will determine the values for min and max
    // based on the input for answer and acceptederror.
    with(document.theform) {
        if (formula0.value=='') {
            alert('<?php  print_string("missingformula","quiz") ?>');
            return false;
            /* It could perhaps be an idea to parse the formula here
             * but as it is necessary at the server anyway, we can
             * leave like this for the moment. */
            
        } else if (''!=defaultunit.value && !isNaN(defaultunit.value)) {
            alert('<?php  print_string("unitmustnotbenumeric","quiz") ?>');
            return false;
        } else if (isNaN(tolerance0.value)) {
            alert('<?php  print_string("tolerancemustbenumeric","quiz") ?>');
            return false;
        } else {
            return true;
        }
    }
}
</script>
