<!-- This page defines the form to create or edit an instance of this module -->
<!-- It is used from /course/mod.php.  The whole instance is available as $form. -->

<?php 
    require_once("$CFG->dirroot/mod/quiz/lib.php");

    if (!isset($form->name)) {
        $form->name = "";
    }
    if (!isset($form->intro)) {
        $form->intro = "";
    }
    if (!isset($form->timeopen)) {
        $form->timeopen = "";
    }
    if (!isset($form->timeclose)) {
        $form->timeclose = "";
    }
    if (!isset($form->attempts)) {
        $form->attempts = $CFG->quiz_attempts;
    }
    if (!isset($form->attemptonlast)) {
        $form->attemptonlast = $CFG->quiz_attemptonlast;
    }
    if (!isset($form->grademethod)) {
        $form->grademethod = $CFG->quiz_grademethod;
    }
    if (!isset($form->feedback)) {
        $form->feedback = $CFG->quiz_showfeedback;
    }
    if (!isset($form->correctanswers)) {
        $form->correctanswers = $CFG->quiz_showanswer;
    }
    if (!isset($form->review)) {
        $form->review = $CFG->quiz_allowreview;
    }
    if (!isset($form->shufflequestions)) {
        $form->shufflequestions = $CFG->quiz_shufflequestions;
    }
    if (!isset($form->shuffleanswers)) {
        $form->shuffleanswers = $CFG->quiz_shuffleanswers;
    }
    if (!isset($form->grade)) {
        $form->grade = $CFG->quiz_maximumgrade;
    }
    if (!isset($form->questions)) {
        $form->questions = "";
    }
    if (!isset($form->password)) {
        $form->password = $CFG->quiz_password;
    }
    if (!isset($form->subnet)) {
        $form->subnet = $CFG->quiz_subnet;
    }
    if (!isset($form->timelimit)) {
        $form->timelimit = $CFG->quiz_timelimit;
    }
    if (!isset($form->popup)) {
        $form->popup = $CFG->quiz_popup;
    }
?>


<form name="form" method="post" action="../mod/quiz/edit.php">
<center>
<table cellpadding="5">

<tr valign="top">
    <td align="right"><b><?php print_string("name") ?>:</b></td>
    <td>
        <input type="text" name="name" size="40" value="<?php p($form->name) ?>" />
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string("introduction", "quiz") ?>:</b>
      <br />
      <span class="editorhelptext">
     <?php
        if ($usehtmleditor) {
           helpbutton("richtext", get_string("helprichtext"), "moodle", true, true);
        } else {
           helpbutton("text", get_string("helptext"), "moodle", true, true); 
           echo '<br />';
           emoticonhelpbutton("form", "description");
           echo '<br />';
        } 
      ?>
      <br />
      </span>
    </td>
    <td>
        <?php 
           print_textarea($usehtmleditor, 20, 50, 680, 400, "intro", $form->intro);
        ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string("quizopen", "quiz") ?>:</b></td>
    <td>
    <?php
        if (!$form->timeopen and $course->format == "weeks") {
            $form->timeopen  = $course->startdate + (($form->section - 1) * 608400);
        }
        print_date_selector("openday", "openmonth", "openyear", $form->timeopen);
        print_time_selector("openhour", "openminute", $form->timeopen);
        helpbutton("timeopen", get_string("quizopen","quiz"), "quiz");
     ?>
    </td>
</tr>

<tr valign="top">
    <td align="right"><b><?php print_string("quizclose", "quiz") ?>:</b></td>
    <td>
    <?php
        if (!$form->timeclose and $course->format == "weeks") {
            $form->timeclose  = $course->startdate + (($form->section) * 608400);
        }
        print_date_selector("closeday", "closemonth", "closeyear", $form->timeclose);
        print_time_selector("closehour", "closeminute", $form->timeclose);
        helpbutton("timeopen", get_string("quizclose","quiz"), "quiz");
     ?>
    </td>
</tr>

<?php if ($CFG->quiz_fix_timelimit) { ?>
    <input type="hidden" name="timelimit" value="<?php p($form->timelimit) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("timelimit", "quiz") ?>:</b></td>
        <td>
        <?php
            print_timer_selector($form->timelimit, get_string("minutes","quiz"));
            helpbutton("timelimit", get_string("quiztimer","quiz"), "quiz");
        ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_shufflequestions) { ?>
    <input type="hidden" name="shufflequestions" value="<?php p($form->shufflequestions) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("shufflequestions", "quiz") ?>:</b></td>
        <td>
        <?php
            $options = array();
            $options[0] = get_string("no");
            $options[1] = get_string("yes");
            choose_from_menu($options, "shufflequestions", "$form->shufflequestions", "");
            helpbutton("shufflequestions", get_string("shufflequestions","quiz"), "quiz");
         ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_shuffleanswers) { ?>
    <input type="hidden" name="shuffleanswers" value="<?php p($form->shuffleanswers) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("shuffleanswers", "quiz") ?>:</b></td>
        <td>
        <?php
            $options = array();
            $options[0] = get_string("no");
            $options[1] = get_string("yes");
            choose_from_menu($options, "shuffleanswers", "$form->shuffleanswers", "");
            helpbutton("shuffleanswers", get_string("shuffleanswers","quiz"), "quiz");
         ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_attempts) { ?>
    <input type="hidden" name="attempts" value="<?php p($form->attempts) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("attemptsallowed", "quiz") ?>:</b></td>
        <td>
        <?php
            $options = array();
            $options[0] = get_string("attemptsunlimited", "quiz");
            $options[1] = "1 ".strtolower(get_string("attempt", "quiz"));
            for ($i=2;$i<=6;$i++) {
                $options[$i] = "$i ".strtolower(get_string("attempts", "quiz"));
            }
            choose_from_menu($options, "attempts", "$form->attempts", "");
            helpbutton("attempts", get_string("attemptsallowed","quiz"), "quiz");
         ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_attemptonlast) { ?>
    <input type="hidden" name="attemptonlast" value="<?php p($form->attemptonlast) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("eachattemptbuildsonthelast", "quiz") ?>:</b></td>
        <td>
        <?php
            $options = array();
            $options[0] = get_string("no");
            $options[1] = get_string("yes");
            choose_from_menu($options, "attemptonlast",
                             "$form->attemptonlast", "");
            helpbutton("repeatattempts",
                       get_string("eachattemptbuildsonthelast", "quiz"),
                       "quiz");
        ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_grademethod) { ?>
    <input type="hidden" name="grademethod" value="<?php p($form->grademethod) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("grademethod", "quiz") ?>:</b></td>
        <td>
        <?php
            $options = array();
            $options[1] = get_string("gradehighest", "quiz");
            $options[2] = get_string("gradeaverage", "quiz");
            $options[3] = get_string("attemptfirst", "quiz");
            $options[4] = get_string("attemptlast", "quiz");
            choose_from_menu($QUIZ_GRADE_METHOD, "grademethod", "$form->grademethod", "");
            helpbutton("grademethod", get_string("grademethod","quiz"), "quiz");
         ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_showfeedback) { ?>
    <input type="hidden" name="feedback" value="<?php p($form->feedback) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("showfeedback", "quiz") ?>:</b></td>
        <td>
        <?php
            $options = array();
            $options[0] = get_string("no");
            $options[1] = get_string("yes");
            choose_from_menu($options, "feedback", "$form->feedback", "");
            helpbutton("feedback", get_string("showfeedback","quiz"), "quiz");
         ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_showanswer) { ?>
    <input type="hidden" name="correctanswers" value="<?php p($form->correctanswers) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("showcorrectanswer", "quiz") ?>:</b></td>
        <td>
        <?php
            $options = array();
            $options[0] = get_string("no");
            $options[1] = get_string("yes");
            choose_from_menu($options, "correctanswers", "$form->correctanswers", "");
            helpbutton("correctanswers", get_string("showcorrectanswer","quiz"), "quiz");
         ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_allowreview) { ?>
    <input type="hidden" name="review" value="<?php p($form->review) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("allowreview", "quiz") ?>:</b></td>
        <td>
        <?php
            $options = array();
            $options[0] = get_string("no");
            $options[1] = get_string("yes");
            choose_from_menu($options, "review", "$form->review", "");
            helpbutton("review", get_string("allowreview","quiz"), "quiz");
         ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_maximumgrade) { ?>
    <input type="hidden" name="grade" value="<?php p($form->grade) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("maximumgrade") ?>:</b></td>
        <td>
        <?php
            for ($i=100; $i>=1; $i--) {
                $grades[$i] = $i;
            }
            $grades[0] = get_string("nograde");
    
            choose_from_menu($grades, "grade", "$form->grade", "");
            helpbutton("maxgrade", get_string("maximumgrade"), "quiz");
         ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_popup) { ?>
    <input type="hidden" name="popup" value="<?php p($form->popup) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("popup", "quiz") ?>:</b></td>
        <td>
        <?php
            $options = array();
            $options[0] = get_string("no");
            $options[1] = get_string("yes");
            choose_from_menu($options, "popup", "$form->popup", "");
            helpbutton("popup", get_string("popup","quiz"), "quiz");
         ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_password) { ?>
    <input type="hidden" name="password" value="<?php p($form->password) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("requirepassword", "quiz") ?>:</b></td>
        <td>
            <input type="text" name="password" size="40" value="<?php p($form->password) ?>" />
            <?php helpbutton("requirepassword", get_string("requirepassword", "quiz"), "quiz"); ?>
        </td>
    </tr>
<?php } ?>

<?php if ($CFG->quiz_fix_subnet) { ?>
    <input type="hidden" name="subnet" value="<?php p($form->subnet) ?>">
<?php } else { ?>
    <tr valign="top">
        <td align="right"><b><?php print_string("requiresubnet", "quiz") ?>:</b></td>
        <td>
            <input type="text" name="subnet" size="40" value="<?php p($form->subnet) ?>" />
            <?php helpbutton("requiresubnet", get_string("requiresubnet", "quiz"), "quiz"); ?>
        </td>
    </tr>
<?php } ?>
    
</table>
<input type="hidden" name="questions"     value="<?php p($form->questions) ?>" />
<!-- these hidden variables are always the same -->
<input type="hidden" name="course"        value="<?php p($form->course) ?>" />
<input type="hidden" name="coursemodule"  value="<?php p($form->coursemodule) ?>" />
<input type="hidden" name="section"       value="<?php p($form->section) ?>" />
<input type="hidden" name="module"        value="<?php p($form->module) ?>" />
<input type="hidden" name="modulename"    value="<?php p($form->modulename) ?>" />
<input type="hidden" name="instance"      value="<?php p($form->instance) ?>" />
<input type="hidden" name="mode"          value="<?php p($form->mode) ?>" />
<input type="hidden" name="destination"   value="<?php echo "$CFG->wwwroot/course/mod.php" ?>" />
<input type="submit" value="<?php print_string("continue") ?>" />
</center>
</form>
