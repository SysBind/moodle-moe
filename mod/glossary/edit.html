<?PHP
    global $CFG;
?>
<center>
<form name="form" method="post" <?=$onsubmit ?> action="edit.php" enctype="multipart/form-data">
<table  class=generalbox cellpadding=5 bgcolor="<?php p($THEME->cellheading)?>">
<?PHP
if (isset($errors)) {
?>
    <tr valign=top>
        <td colspan=2 align=center><strong><font color=red><?PHP p($errors) ?></font></strong>
        </td>
    </tr>
<?PHP
}
?>
<tr valign=top>
    <td align=right><p><b><?php echo get_string("concept","glossary") ?>:</b></p></td>
    <td>
        <INPUT type="text" name="concept" size=30 value="<?php p($newentry->concept) ?>">
    </td>
</tr>
<tr valign=top>
    <td align=right><p><b><?php echo get_string("categories","glossary") ?>:</b></p></td>
    <td>	
    <?php
        $categories = get_records("glossary_categories","glossaryid",$glossary->id);
        echo "<select size=\"6\" name=\"categories[]\" multiple=\"yes\">";
        echo "<option value=\"0\">" . get_string("notcategorised","glossary") . "</optioon>";

        if ( $categories ) {
            foreach ( $categories as $category ) {
                echo "  <option ";
                if (isset($newentry->id)) {
                    if ( record_exists("glossary_entries_categories","entryid",$newentry->id,"categoryid",$category->id) ) {
                        echo "selected " ;
                    }
                }
                echo "value=\"$category->id\">$category->name</option>\n";
            }
        }
    ?>
    </select>
    </td>
</tr>
<tr valign=top>
    <td align=right><p><b><?php echo get_string("entryusedynalink","glossary") ?>:</b></p></td>
    <td>
    <script>
        var items = ['casesensitive','fullmatch'];
    </script>
<?php
    $selected = "";
    if ( isset($newentry->usedynalink) ) {
        if ($newentry->usedynalink) {
            $selected = "checked";
        }
    } elseif ( $CFG->automatically_link_entry ) {
        $selected = "checked";
    }
?> 
    <input type="checkbox" name="usedynalink" value=1 <?php p($selected) ?> onclick="return lockoptions('form','usedynalink', items)"> <?php helpbutton("usedynalink", get_string("usedynalink", "glossary"), "glossary") ?>
    </td>
</tr>
<tr valign=top>
    <td align=right><p><b><?php echo get_string("casesensitive","glossary") ?>:</b></p></td>
    <td>
    <select size="1" name="casesensitive">
     <option value=1 <?php
      if ( isset($newentry->casesensitive) ) {
          if ( $newentry->casesensitive ) {
             echo "selected";
          }
      } elseif ( $CFG->case_sensitive ) {
          echo "selected";
      }
      ?> 
      ><?php echo get_string("yes") ?></option>
     <option value=0 <?php
      if ( isset($newentry->casesensitive) ) {
          if ( !$newentry->casesensitive ) {
             echo "selected";
          }
      } elseif ( !$CFG->case_sensitive ) {
          echo "selected";
      }
      ?>><?php echo get_string("no") ?>
     </option>
     </select> <?php helpbutton("casesensitive", get_string("casesensitive", "glossary"), "glossary") ?>
    </td>
</tr>
<tr valign=top>
    <td align=right><p><b><?php echo get_string("fullmatch","glossary") ?>:</b></p></td>
    <td>
    <select size="1" name="fullmatch">
     <option value=1 <?php
      if ( isset($newentry->fullmatch) ) {
          if ( $newentry->fullmatch ) {
             echo "selected";
          }
      } elseif ( $CFG->match_whole_words ) {
          echo "selected";
      }
      ?> 
      ><?php echo get_string("yes") ?></option>
     <option value=0 <?php
      if ( isset($newentry->fullmatch) ) {
          if ( !$newentry->fullmatch ) {
             echo "selected";
          }
      } elseif ( !$CFG->match_whole_words ) {
          echo "selected";
      }
      ?>><?php echo get_string("no") ?>
     </option>
     </select> <?php helpbutton("fullmatch", get_string("fullmatch", "glossary"), "glossary") ?>
    </td>
</tr>
<tr valign=top>
    <td align=right><p><b><?php echo get_string("definition","glossary") ?>:</b></p>
    <font size="1">
     <?php
        helpbutton("writing", get_string("helpwriting"), "moodle", true, true);
        echo "<br />";
        if ($usehtmleditor) {
           helpbutton("richtext", get_string("helprichtext"), "moodle", true, true);
        } else {
           emoticonhelpbutton("form", "description");
        } 
      ?>
      <br />
    </font>
    </td>
    <td>
    <?php
       print_textarea($usehtmleditor, 20, 60, 680, 400, "text", $newentry->definition);
    
       echo "<p align=right>";
   	 helpbutton("textformat", get_string("helpformatting"));
       print_string("formattexttype");
       echo ":&nbsp;";
       if (!isset($newentry->format)) {
           $newentry->format = $defaultformat;
       }
       choose_from_menu(format_text_menu(), "format", $newentry->format, ""); 
       echo "</p>";
    ?>
    </td>
</tr>
<tr valign=top>
    <td align=right><p><b><?php print_string("attachment", "glossary") ?>:<br \>(<?php print_string("optional") ?>)&nbsp;</b></p></td>
    <td>
    <input type="hidden" name="MAX_FILE_SIZE" value="<?php echo get_max_upload_file_size() ?>">
    <input type="file" name="attachment" size=40> 
    <?php 
       helpbutton("attachment", get_string("attachment", "glossary"), "glossary"); 
       print_string("maxsize", "", display_size(get_max_upload_file_size())); 
    ?>
    </td>
</tr>
<tr>
<td colspan=2>
	<p align=center>
	<?php if (isset($newentry->id)) {
		echo "<input type=\"hidden\" name=e value=\"$newentry->id\">";
   	 }
	?>

	<input type="hidden" name=husedynalink value="1">
	<input type="hidden" name=hcasesensitive value="0">
	<input type="hidden" name=hfullmatch value="1">

	<input type="hidden" name=id value="<?=$cm->id ?>">
	<input type="hidden" name=tab value="<?=$tab ?>">
	<input type="hidden" name=cat value="<?=$cat ?>">
	<input type="hidden" name=confirm value="1">

	<input type="submit" value="<?php print_string("savechanges") ?>">
	<input type="reset" value="<?php print_string("revert") ?>">
	</P>
</td>
</tr>
</table>
</center>


</form>

<?PHP 
   if ($usehtmleditor) { 
       print_richedit_javascript("form", "text", "yes");
   }
?>

