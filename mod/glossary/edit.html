<?PHP
    global $CFG;
?>
<center>
<form name="form" method="post" <?=$onsubmit ?> action="edit.php" enctype="multipart/form-data">
<table  class=generalbox cellpadding=5 bgcolor="<?php p($THEME->cellheading)?>">
<?PHP
if (isset($errors)) {
?>
    <tr valign=top>
        <td colspan=2 align=center><strong><font color=red><?PHP p($errors) ?></font></strong>
        </td>
    </tr>
<?PHP
}
?>
<tr valign=top>
    <td align=right><p><b><?php echo get_string("concept","glossary") ?>:</b></p></td>
    <td>
	<table boder="0" width="100%">
	    <tr>
		<td>
        <INPUT type="text" name="concept" size=30 value="<?php p($newentry->concept) ?>"></td>
	    <td align="right">
<?PHP 
    if ( !$glossary->usedynalink ) {
    	echo '<input type="hidden" name=usedynalink value="0">';
    	echo '<input type="hidden" name=casesensitive value="0">';
    	echo '<input type="hidden" name=fullmatch value="0">';
    } else {
        echo '<small>' . get_string("entryusedynalink","glossary") . ':</small>';
        echo '<script>var items = [\'casesensitive\',\'fullmatch\'];</script>';
        $selected = "";
        if ( isset($newentry->usedynalink) ) {
            if ($newentry->usedynalink) {
                $selected = "checked";
            }
        } elseif ( $CFG->glossary_linkentries ) {
            $selected = "checked";
        }
        echo '<input type="checkbox" name="usedynalink" value=1 ' . $selected . ' onclick="return lockoptions(\'form\',\'usedynalink\', items)"> ' . helpbutton("usedynalink", strip_tags(get_string("usedynalink", "glossary")), "glossary"); 
    }
?> 
	</td></tr></table>
    </td>
</tr>
<tr valign=top>
    <td align=right><p><b><?php echo get_string("categories","glossary") ?>:</b></p></td>
    <td valign="top">
    <table border=0>
    <tr>
    <td valign="top">
    <?php
        $categories = get_records("glossary_categories","glossaryid",$glossary->id);
        echo "<select size=\"5\" name=\"categories[]\" multiple=\"yes\">";
        echo "<option value=\"0\">" . get_string("notcategorised","glossary") . "</optioon>";

        if ( $categories ) {
            foreach ( $categories as $category ) {
                echo "  <option ";
                if (isset($newentry->id)) {
                    if ( record_exists("glossary_entries_categories","entryid",$newentry->id,"categoryid",$category->id) ) {
                        echo "selected " ;
                    }
                }
                echo "value=\"$category->id\">$category->name</option>\n";
            }
        }
    ?>
    </select>
    </td>
    <td width="100%" valign="top">
    <table border="0">
        <tr>
        <td align="center" width="58%" valign="top">
<?PHP 
    if ( $glossary->usedynalink ) {
        
        echo '<table border="0" width="100%">';
    	echo '<tr><td colspan="2" align="right"><small><strong> ' . get_string("aliases","glossary") . ' ';
        helpbutton("aliases", strip_tags(get_string("aliases", "glossary")), "glossary");
        echo '</strong><p></td></tr>';
        echo '<tr><td align="right" width="80%" valign="top"><small> ' . get_string("casesensitive","glossary") . ':</small></td><td width=20%>';

        $selected = "";
        if ( isset($newentry->casesensitive) ) {
            if ($newentry->casesensitive) {
                $selected = "checked";
            }
        } elseif ( $CFG->glossary_casesensitive ) {
            $selected = "checked";
        }
        echo '<input type="checkbox" name="casesensitive" value=1 ' . $selected . '> ' . helpbutton("casesensitive", strip_tags(get_string("casesensitive", "glossary")), "glossary");
        echo '</td></tr>';
        echo '<tr><td align="right" width="80%" valign="top"><small>' . get_string("fullmatch","glossary") . ':</small></td><td width=20%>';

        $selected = "";
        if ( isset($newentry->fullmatch) ) {
            if ($newentry->fullmatch) {
                $selected = "checked";
            }
        } elseif ( $CFG->glossary_fullmatch ) {
            $selected = "checked";
        }
        echo '<input type="checkbox" name="fullmatch" value=1 ' .  $selected . ' ' . helpbutton("fullmatch", strip_tags(get_string("fullmatch", "glossary")), "glossary");
        echo '</td></tr>';
        echo '</table>';

        echo '</td>';
        echo '<td align="center" width="42%" valign="top">';
        echo '<textarea rows="5" name="aliases" cols="20">' . $newentry->aliases . '</textarea>';
        echo '</td>';
        echo '</tr>';
    }  // end-if !$usedynalink
    echo '</td></tr></table>';
?>

    </td>
    </tr>
    </table>
    </td>
</tr>
<tr valign=top>
    <td align=right><p><b><?php echo get_string("definition","glossary") ?>:</b></p>
    <font size="1">
     <?php
        helpbutton("writing", get_string("helpwriting"), "moodle", true, true);
        echo "<br />";
        if ($usehtmleditor) {
           helpbutton("richtext", get_string("helprichtext"), "moodle", true, true);
        } else {
           emoticonhelpbutton("form", "description");
        } 
      ?>
      <br />
    </font>
    </td>
    <td>
    <?php
       print_textarea($usehtmleditor, 20, 60, 680, 400, "text", $newentry->definition);
    
       echo "<p align=right>";
       helpbutton("textformat", get_string("helpformatting"));
       print_string("formattexttype");
       echo ":&nbsp;";
       if (!isset($newentry->format)) {
           $newentry->format = $defaultformat;
       }
       choose_from_menu(format_text_menu(), "format", $newentry->format, ""); 
       echo "</p>";
    ?>
    </td>
</tr>
<tr valign=top>
    <td align=right><p><b><?php print_string("attachment", "glossary") ?>:<br \>(<?php print_string("optional") ?>)&nbsp;</b></p></td>
    <td>
    <input type="hidden" name="MAX_FILE_SIZE" value="<?php echo get_max_upload_file_size() ?>">
    <input type="file" name="attachment" size=40> 
    <?php 
       helpbutton("attachment", get_string("attachment", "glossary"), "glossary"); 
       print_string("maxsize", "", display_size(get_max_upload_file_size())); 
    ?>
    </td>
</tr>
<tr>
<td colspan=2>
    <p align=center>
    <?php if (isset($newentry->id)) {
        echo "<input type=\"hidden\" name=e value=\"$newentry->id\">";
   	 }
	?>

	<input type="hidden" name=husedynalink value="1">
	<input type="hidden" name=hcasesensitive value="0">
	<input type="hidden" name=hfullmatch value="1">

	<input type="hidden" name=id value="<?=$cm->id ?>">
	<input type="hidden" name=mode value="<?=$mode ?>">
	<input type="hidden" name=hook value="<?=$hook ?>">
	<input type="hidden" name=confirm value="1">

	<input type="submit" value="<?php print_string("savechanges") ?>">
	<input type="reset" value="<?php print_string("revert") ?>">
	</P>
</td>
</tr>
</table>
</center>


</form>

<?PHP 
   if ($usehtmleditor) { 
       print_richedit_javascript("form", "text", "yes");
   }
?>

