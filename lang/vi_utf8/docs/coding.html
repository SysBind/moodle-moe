<html>
<head>
<title>Tài liệu Moodle: Các hướng dẫn Code</title>
<link rel="stylesheet" href="docstyles.css" type="TEXT/CSS">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>
<body bgcolor="#FFFFFF">
<h1>Các hướng dẫn về coding trong Moodle</h1>
<p class="normaltext">Bất kỳ một dự án nào cũng cần tính nhất quán và ổn định 
  để có thể tồn tại lâu dài.</p>
<p class="normaltext">Các hướng dẫn sau cung cấp một mục tiêu chung để tất cả các mã Moodle 
  có thể phát triển tốt. Sự thật là một vài các đoạn mã tồn tại trước đó chưa đáp ứng được
  một vài yêu cầu, tuy nhiên nó sẽ được sửa sau này. Tất cả các mã mới phải tuân theo
  một cách hoàn toàn các chuẩn dưới đây càng chính xác càng tốt.</p>
<h2>General Rules</h2>
<ol class="normaltext">
  <li class="spaced">Tất cả các file mã phải sử dụng phần mở rộng .php.</li>
  <li class="spaced">Tất cả các file mẫu phải sử dụng phần mở rộng .html.</li>
  <li class="spaced">Tẩt các file text nên sử dụng định dạng kiểu Unix (đa số
    các bộ soạn thảo text có lựa chọn này).</li>
  <li class="spaced">Tất cả các thẻ PHP phải là các thẻ 'đầy đủ' giống như <font color="#339900">&lt;?php 
    ?&gt;</font> ... không phải là các thẻ 'ngắn' giống như <font color="#339900">&lt;? ?&gt;</font>. 
  </li>
  <li class="spaced">Tất cả các chú thích về bản quyền phải được giữ nguyên. Bạn có thể 
    đưa thêm của bạn vào nếu cần thiết.</li>
  <li class="spaced">Mỗi file nên gồm file chính config.php.</li>
  <li class="spaced">Mỗi file nên kiểm tra rằng người dùng được chứng thực đúng đắn, 
    sử dụng require_login() và isadmin(), isteacher(), iscreator() hoặc isstudent().</li>
  <li class="spaced">Tất cả các truy cập tới các cơ sở dữ liệu phải sử dụng các hàm trong lib/datalib.php 
    bất cứ khi nào có thể - nó đảm bảo tính khả chuyển giữa nhiều cơ sở dữ liệu khác nhau. 
    Bạn có thể tìm thấy đa số mọi thứ là có thể bằng cách sử dụng các hàm này. Nếu bạn phải viết mã SQL hãy đảm bảo rằng: không phụ thuộc nền; hạn chế các hàm cụ thể
    ngay trong file của bạn (thương là trong lib.php ); và được đánh dấu, chú thích cẩn thận, rõ ràng.</li>
  <li class="spaced">Đừng tạo hoặc sử dụng các biến toàn cục trừ các biến chuẩn
    $CFG, $SESSION, $THEME và $USER.</li>
  <li class="spaced">Tất cả các biến nên được khởi tạo hoặc ít nhất được thử
    tính tồn tại thông qua sử dụng isset() hoặc empty() trước khi chúng được sử dụng.</li>
  <li class="spaced">Tẩt cả các xâu nên có thể dịch được - tạo các text mới trong
    các file &quot;lang/en&quot;  với các tên tiếng Anh chính xác chữ thường và lấy chúng từ mã
    thông qua sử dụng get_string() hoặc print_string().</li>
  <li class="spaced">Tất cả các file trợ giúp nên có thể dịch được  - tạo các text mới 
    trong thư mục &quot;en/help&quot; và gọi chúng sử dụng helpbutton().
    <p>Nếu bạn cần cập nhật một file trợ giúp: 
    <ul>
    <li>với một sự thay đổi nhỏ, nơi mà bản dịch cũ
        của file vẫn có ý nghĩa, thì có thể thực hiện thay đổi trên bản dịch cũ
        nhưng phải thông báo cho translation@moodle.org</li>
    <li>với một sự thay đổi lớn bạn nên tạo một file mới bằng cách đưa vào
        một số tăng (ví dụ filename2.html) sao cho các người dịch
        có thể dễ dàng nhìn thấy phiên bản mới của file.  Hiển nhiên
        mã mới và các chỉ sổ file trợ giúp nên được thay đổi để chỉ ra phiên  
        tới phiên bản mới nhất.</li>
    </ul>
    </p>
</li>
  <li class="spaced">Các dữ liệu đến từ trình duyệt (được gửi thông qua GET hoặc POST) tự động
    được xử lý bằng magic_quotes (không quan tâm tới việc thiết lập trong PHP) sao cho bạn có thể
    chèn chúng an toàn vào cơ sở dữ liệu.  Tất cả các dữ liệu thô khác (từ các files, hoặc từ các cơ sở dữ liệu)
    phải được thoát bởi <font color="#339900">addslashes()</font> trước khi chèn nó vào cơ sở dữ liệu.</li>
  <li class="spaced">QUAN TRỌNG:  Mọi text bên trong Moodle, đặc biệt là xuất phát từ 
    người dùng, sẽ được in sử dụng hàm format_text().  Điều này đảm bảo rằng 
    text được lọc và xoá theo đúng cách.</li>
</ol>
<p>&nbsp;</p>
<h2>Phong cách coding</h2>
<p class="normaltext">Tôi biết có thể khó chịu cho bạn khi thay đổi phong cách 
  nếu bạn đã quen với cái gì đó, nhưng bù lại mọi người sau này sẽ dễ tiếp cận 
  với mã. 
  Hiển nhiên có nhiều lí do mà mọi người nên theo một phong cách viết mã thống nhất , 
  chúng sẽ được quy định dưới đây <strong>như sau</strong>, xin hãy tuân thủ theo nó. </p>
<ol class="normaltext">
  <li class="spaced"><strong>Indenting</strong> should be consistently 4 spaces. 
    Don't use tabs AT ALL. </li>
  <li class="spaced"><strong>Variable names</strong> should always be easy-to-read, 
    meaningful lowercase English words. If you really need more than one word 
    then run them together, but keep them short as possible. Use
plural names for arrays of objects.
    <p class="examplecode"><font color="#006600">GOOD: $quiz<br />
      GOOD: $errorstring<br />
GOOD: $assignments (for an array of objects)<br />
      GOOD: $i (but only in little loops)<br />
      <br />
      BAD: $Quiz <br />
      BAD: $aReallyLongVariableNameWithoutAGoodReason<br />
      BAD: $error_string</font></p>
  </li>
  <li class="spaced"><strong>Constants</strong> should always be in upper case, 
    and always start with the name of the module. They should have words separated 
    by underscores. 
    <p class="examplecode"><font color="#006600">define(&quot;FORUM_MODE_FLATOLDEST&quot;, 
      1);</font></p>
  </li>
  <li class="spaced"><strong>Function names</strong> should be simple English 
    lowercase words, and start with the name of the module to avoid conflicts between modules. 
    Words should be separated by underscores. Parameters should always have sensible 
    defaults if possible. Note there is no space between the function name and 
    the following (brackets). <br />
    <p class="examplecode"> <font color="#007700">function </font><font color="#0000BB">forum_set_display_mode</font><font color="#007700">(</font><font color="#0000BB">$mode</font><font color="#007700">=</font><font color="#0000BB">0</font><font color="#007700">) 
      {<br />
      &nbsp;&nbsp;&nbsp;&nbsp;global </font><font color="#0000BB">$USER</font><font color="#007700">, 
      </font><font color="#0000BB">$CFG</font><font color="#007700">;<br />
      <br />
      &nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$mode</font><font color="#007700">) 
      {<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$USER</font><font color="#007700">-&gt;</font><font color="#0000BB">mode 
      </font><font color="#007700">= </font><font color="#0000BB">$mode</font><font color="#007700">;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;} else if (empty(</font><font color="#0000BB">$USER</font><font color="#007700">-&gt;</font><font color="#0000BB">mode</font><font color="#007700">)) 
      {<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$USER</font><font color="#007700">-&gt;</font><font color="#0000BB">mode 
      </font><font color="#007700">= </font><font color="#0000BB">$CFG</font><font color="#007700">-&gt;</font><font color="#0000BB">forum_displaymode</font><font color="#007700">;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;}<br />
      }</font></p>
  </li>
  <li class="spaced"><strong>Blocks</strong> must always be enclosed in curly 
    braces (even if there is only one line). Moodle uses this style: 
    <p class="examplecode"> <font color="#006600">if (</font><font color="#0000CC">$quiz</font><font color="#006600">-&gt;</font><font color="#0000CC">attempts</font><font color="#006600">) 
      {<br />
      &nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000CC">$numattempts </font><font color="#006600">&gt; 
      </font><font color="#0000CC">$quiz</font><font color="#006600">-&gt;</font><font color="#0000CC">attempts</font><font color="#006600">) 
      {<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000CC">error</font><font color="#006600">(</font><font color="#0000BB">$strtoomanyattempts</font><font color="#006600">, 
      </font><font color="#CC0000">"view.php?id=$cm</font><font color="#006600">-&gt;</font><font color="#CC0000">id"</font><font color="#006600">);<br />
      &nbsp;&nbsp;&nbsp;&nbsp;}<br />
      }</font></p>
  </li>
  <li class="spaced"><strong>Strings</strong> should be defined using single quotes 
    where possible, for increased speed.<br />
    <p class="examplecode"> <font color="#006600">$var = 'some text without any 
      variables';<br />
      $var = &quot;with special characters like a new line \n&quot;;<br />
      $var = 'a very, very long string with a '.$single.' variable in it';<br />
      $var = &quot;some $text with $many variables $within it&quot;; </font></p>
  </li>
  <li class="spaced"><strong>Comments</strong> should use two or three slashes 
    and line up nicely with the code. 
    <p class="examplecode"><font color="#006600">function </font><font color="#0000BB">forum_get_ratings_mean</font><font color="#007700">(</font><font color="#0000BB">$postid</font><font color="#007700">, 
      </font><font color="#0000BB">$scale</font><font color="#007700">, </font><font color="#0000BB">$ratings</font><font color="#007700">=</font><font color="#0000BB">NULL</font><font color="#007700">) 
      {<br />
      </font><font color="#FF8000">/// Return the mean rating of a post given 
      to the current user by others.<br />
      /// Scale is an array of possible ratings in the scale<br />
      /// Ratings is an optional simple array of actual ratings (just integers)<br />
      <br />
      &nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if (!</font><font color="#0000BB">$ratings</font><font color="#007700">) 
      {<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$ratings 
      </font><font color="#007700">= array(); &nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// 
      Initialize the empty array</font><font color="#007700"><br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000BB">$rates 
      </font><font color="#007700">= </font><font color="#0000BB">get_records</font><font color="#007700">(</font><font color="#DD0000">"forum_ratings"</font><font color="#007700">, 
      </font><font color="#DD0000">"post"</font><font color="#007700">, </font><font color="#0000BB">$postid</font><font color="#007700">)) 
      {<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">// 
      Process each rating in turn</font><font color="#007700"><br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach 
      (</font><font color="#0000BB">$rates </font><font color="#007700">as </font><font color="#0000BB">$rate</font><font color="#007700">) 
      {</font> <br />
      ....etc </p>
  </li>
  <li class="spaced"><strong>Space</strong> should be used liberally - don't be 
    afraid to spread things out a little to gain some clarity. Generally, there 
    should be one space between brackets and normal statements, but no space between 
    brackets and variables or functions:<br />
    <p class="examplecode"> <font color="#007700">foreach (</font><font color="#0000BB">$objects 
      </font><font color="#007700">as </font><font color="#0000BB">$key </font><font color="#007700">=&gt;</font><font color="#0000BB"> 
      $thing</font><font color="#007700">)</font><font color="#006600"> {<br />
      </font><font color="#007700">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">process($thing);</font><font color="#006600"> 
      <br />
      } <br />
      <br />
      </font><font color="#007700">if (</font><font color="#0000BB">$x </font><font color="#007700">== 
      </font><font color="#0000BB">$y</font><font color="#007700">)</font><font color="#006600"> 
      {<br />
      </font><font color="#007700">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$a 
      </font><font color="#007700">= </font><font color="#0000BB">$b</font><font color="#007700">;</font><font color="#006600"><br />
      } else if (</font><font color="#0000BB">$x </font><font color="#007700">== 
      </font><font color="#0000BB">$z</font><font color="#006600">) {<br />
      </font><font color="#007700">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$a 
      </font><font color="#007700">= </font><font color="#0000BB">$c</font><font color="#007700">;</font><font color="#006600"><br />
      } else {<br />
      </font><font color="#007700">&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$a 
      </font><font color="#007700">= </font><font color="#0000BB">$d</font><font color="#007700">;</font><font color="#006600"><br />
      } </font></p>
  </li>
</ol>
<p>&nbsp;</p>
<h2>Database structures</h2>
<ol class="normaltext">
  <li class="spaced">Every table must have an auto-incrementing <strong>id</strong> field (INT10) as primary index.</li>
  <li class="spaced">The main table containing instances of each module must have the same name as the module (eg <strong>widget</strong>) and contain the following minimum fields:
    <ul>
      <li><strong>id</strong> - as described above</li>
      <li><strong>course</strong> - the id of the course that each instance belongs to</li>
      <li><strong>name</strong> - the full name of each instance of the module</li>
    </ul>
  </li>
  <li class="spaced">Other tables associated with a module that contain information about 'things' should be named <strong>widget_things</strong> (note the plural).</li>
  <li class="spaced">Column names should be simple and short, following the same rules as for variable names.</li>
  <li class="spaced">Where possible, columns that contain a reference to the id field of another table (eg <strong>widget</strong>) should be called <strong>widgetid</strong>. (Note that this convention is newish and not followed in some older tables)</li>
  <li class="spaced">Boolean fields should be implemented as small integer fields (eg INT4) containing 0 or 1, to allow for later expansion of values if necessary.</li>
  <li class="spaced">Most tables should have a <strong>timemodified</strong> field (INT10) which is updated with a current timestamp obtained with the PHP <strong>time</strong>() function.</li>
</ol>
<hr />
<p align="CENTER"><font size="1"><a href="." target="_top">Moodle Documentation</a></font></p>
<p align="CENTER"><font size="1">Version: $Id$</font></p>
</body>
</html>
