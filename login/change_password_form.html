
<?php 
    // only display this help message if we are being forced to change
    if ($forcepassword) {
        notify( get_string('forcepasswordchangenotice') );
    }
 ?>
<p><b><?php print_string("allfieldsrequired") ?></b></p>
<?php
   if (empty($frm->username)) {
       $frm->username = "";
   }
   if (empty($frm->password)) {
       $frm->password = "";
   }
   if (empty($frm->newpassword1)) {
       $frm->newpassword1 = "";
   }
   if (empty($frm->newpassword2)) {
       $frm->newpassword2 = "";
   }
?>
<form action="change_password.php" method="post" name="form" id="form">
<table cellpadding="10">

<tr valign="top">
    <td><label for="username"><?php print_string("username") ?></label>:</td>
    <td>
    <?php if (has_capability('moodle/user:update',get_context_instance(CONTEXT_SYSTEM, SITEID)) || empty($frm->username)) { ?>
        <input type="text" name="username" id="username" size="25" value="<?php p($frm->username) ?>" />
    <?php } else { ?>
        <input type="hidden" name="username" id="username" value="<?php p($frm->username)?>" />  <?php p($frm->username)?>
    <?php } ?>
    <?php if (!empty($err->username)) { formerr($err->username); } ?>
    </td>
</tr>

<?php if (!has_capability('moodle/user:update',get_context_instance(CONTEXT_SYSTEM, SITEID))) { ?>
    <tr valign="top">
        <td><label for="password"><?php print_string("oldpassword") ?></label>:</td>
        <td><input type="password" name="password" id="password" size="25" value="<?php p($frm->password) ?>" />
        <?php if (!empty($err->password)) { formerr($err->password); } ?>
        </td>
    </tr>
<?php } else { ?>
        <input type="hidden" name="password" id="password" value="" />
<?php } ?>
    

<tr valign="top">
    <td><label for="newpassword1"><?php print_string("newpassword") ?></label>:</td>
    <td><input type="password" name="newpassword1" id="newpassword1" size="25" value="<?php p($frm->newpassword1) ?>" />
    <?php if (!empty($err->newpassword1)) { formerr($err->newpassword1); } ?>
    </td>
</tr>
<tr valign="top">
    <td><label for="newpassword2"><?php print_string("newpassword") ?> (<?php print_string("again") ?>)</label>:</td>
    <td><input type="password" name="newpassword2" id="newpassword2" size="25" value="<?php p($frm->newpassword2) ?>" />
    <?php if (!empty($err->newpassword2)) { formerr($err->newpassword2); } ?>
    </td>
</tr>
<tr>
    <td></td>
    <td><input type="hidden" name="id" value="<?php p($frm->id)?>" />
    <input type="submit" value="<?php print_string("changepassword") ?>" /></td>
    </tr>
  </table>
</form>
