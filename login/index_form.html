<?php
if ($show_instructions) {
    $mainwidth = '90%';
    $leftwidth = '50%';
} else {
    $mainwidth = '40%';
    $leftwidth = '100%';
}
?>
<table width="<?php echo $mainwidth ?>" border="0" cellpadding="5" style="margin-left:auto;margin-right:auto" class="loginbox" summary="">
<?php if ($show_instructions) { ?>
  <tr>
    <th style="width:50%" class="header left" scope="col">
      <?php  print_string("returningtosite") ?>
    </th>
    <th style="width:50%" class="header right" scope="col">
      <?php  print_string("firsttime") ?>
    </th>
  </tr>
<?php } ?>
  <tr>
    <td style="width:<?php echo $leftwidth ?>" valign="top" class="content left">
      <div style="text-align:center"><?php print_string("loginusing") ?>:
        <?php
        if (empty($CFG->usesid)) {
            echo "<br />(";
            print_string("cookiesenabled");
            echo ")";
            helpbutton("cookies", get_string("cookiesenabled"));
        }
        if (!empty($errormsg)) {
            echo '<div>';
            formerr($errormsg);
            echo '</div>';
        }
        ?>
      </div>
      <form action="index.php" method="post" id="login">
        <table border="0" style="margin-left:auto;margin-right:auto" summary="">
        <tr>
          <td style="width:80%">
            <table style="margin-left:auto;margin-right:auto" class="loginform" summary="">
              <tr class="username"> 
                <td style="text-align:right" class="c0">
                  <label for="username"><?php print_string("username") ?></label>
                </td>
                <td class="c1">
                  <input type="text" name="username" id="username" size="15" value="<?php p($frm->username) ?>" /> 
                </td>
              </tr>
              <tr class="password"> 
                <td style="text-align:right" class="c0">
                  <label for="password"><?php print_string("password") ?></label>
                </td>
                <td class="c1">
                  <input type="password" name="password" id="password" size="15" value="" />
                </td>
              </tr>
            </table>
          </td>
          <td style="width:20%">
            <input type="submit" value="<?php print_string("login") ?>" />
            <input type="hidden" name="testcookies" value="1" />
          </td>
        </tr>
        </table>
      </form>

<?php if ($CFG->guestloginbutton) {  ?>
      <hr style="width:80%" />
      <div style="text-align:center"><?php print_string("someallowguest") ?>:
        <form action="index.php" method="post" id="guestlogin">
         <div>
          <input type="hidden" name="username" value="guest" />
          <input type="hidden" name="password" value="guest" />
          <input type="hidden" name="testcookies" value="1" />
          <input type="submit" value="<?php print_string("loginguest") ?>" />
         </div>
        </form>
      </div>
<?php } ?>

<?php
    $changebuttonname = get_string("passwordrecovery");
    $sesskey = sesskey();
?>
      <hr style="width:80%" />
      <div style="text-align:center"><?php print_string("forgotten") ?> 
        <form action="forgot_password.php" method="post" id="changepassword">
         <div>
          <input type="hidden" name="sesskey" value="<?php echo $sesskey; ?>" />
          <input type="submit" value="<?php p($changebuttonname) ?>" />
         </div>
        </form>
      </div>
    </td>

<?php if ($show_instructions) { ?>
    <td style="width:50%" valign="top" class="content right">
<?php     switch ($authsequence[0]) {
              case "email":
                 print_string("loginsteps", "", "signup.php");
?>
                 <div style="text-align:center">
                   <form action="signup.php" method="get" id="signup">
                   <div><input type="submit" value="<?php print_string("startsignup") ?>" /></div>
                   </form>
                 </div>
<?php            break;

               case "none":
                 print_string("loginstepsnone");
                 break;

               default:
                 echo format_text($CFG->auth_instructions);
                 // TODO: if !function_exists(auth_user_login) then require_once /auth/$CFG->auth/lib.php
                 // ..which implies that auth_user_login might have been floating
                 // about in global namespace. grr
                 $authplugin = get_auth_plugin($CFG->auth);
                 if (!empty($CFG->auth_user_create) and method_exists($authplugin, 'user_create') ){
?>
                 <div style="text-align:center">
                    <form action="signup.php" method="get" id="signup">
                    <div><input type="submit" value="<?php print_string("startsignup") ?>" /></div>
                    </form>
                 </div>
<?php            }
          }
?>
    </td>
<?php } ?>
</tr>
</table>